<h3>Overview</h3>
<p>BETYdb runs on a Red Hat Enterprise Linux version 5.8 Server. To simulate this environment, we have set up a CentOS 5.8 server at pecandev.igb.illinois.edu for testing </p>
<h3>Create an netinstall of the CentOS ISO</h3>
<h3>Boot from CD and Install</h3>
<ul>
<li>Following instructions here: http://www.if-not-true-then-false.com/2010/centos-netinstall-network-installation/</li>
<li>Download this iso: http://vault.centos.org/5.8/isos/x86_64/CentOS-5.8-x86_64-netinstall.iso</li>
<li>it is the "netinstall" version, small enough to fit on a CD, but requires internet to install</li>
<li>burn to CD</li>
<li>boot from CD</li>
<li>ftp server: <code>vault.centos.org</code></li>
<li>directory: <code>5.8/os/x86_64</code></li>
</ul>
<h3>Configuration</h3>
<ol>
<li>Add new user
 <code>adduser johndoe</code></li>
<li>add user to root
 <code>sudo su
emacs /etc/sudoers</code></li>
<li>
<p>add the line 
<code>johndoe  ALL=(ALL)  ALL</code></p>
</li>
<li>
<p>Keep time updated (source: <a href="http://serverfault.com/q/368602">ServerFault</a>)</p>
</li>
</ol>
<p><code>{bash}
yum install ntp
/sbin/chkconfig ntpd on         ## check that it is on
/usr/sbin/ntpdate pool.ntp.org  ## set system date
/etc/init.d/ntpd start</code></p>
<h3>Add new repository</h3>
<p>instructions here: http://www.rackspace.com/knowledge_center/article/installing-rhel-epel-repo-on-centos-5x-or-6x</p>
<p><code>wget http://dl.fedoraproject.org/pub/epel/5/x86_64/epel-release-5-4.noarch.rpm
sudo rpm -Uvh epel-release-5*.rpm</code></p>
<p>... move to PEcAn wiki page for build environment https://github.com/PecanProject/pecan/wiki/Development-Environment-Setup-and-VM-Creation#install-build-environment</p>
<p>Remember to install R 3.0:
<code>wget http://cran.us.r-project.org/src/base/R-3/R-3.0.1.tar.gz
tar xzf R-3.0.1.tar.gz
cd R-3.0.1
./configure
make
sudo make install</code></p>
<h3>Site data installation</h3>
<p>```
cd /usr/local/ebi</p>
<p>rm -rf sites
curl -o sites.tgz http://isda.ncsa.illinois.edu/~kooper/EBI/sites.tgz
tar zxf sites.tgz
sed -i -e "s#/home/kooper/projects/EBI#${PWD}#" sites/*/ED_MET_DRIVER_HEADER
rm sites.tgz</p>
<p>rm -rf inputs
wget http://isda.ncsa.illinois.edu/~kooper/EBI/inputs.tgz
tar zxf inputs.tgz
rm inputs.tgz
```</p>
<h3>Database Creation</h3>
<p>```</p>
<h1>sets up the user for the bety database</h1>
<p>mysql -u root -p -e "create database test; create database production;"
mysql -u root -p -e "grant all on bety.* to bety@localhost identified by 'bety';"
wget -O /usr/local/ebi/updatedb.sh http://isda.ncsa.illinois.edu/~kooper/EBI/updatedb.sh
chmod 755 /usr/local/ebi/updatedb.sh
```</p>
<p>Open up updatedb.sh and remove the two lines</p>
<p>```</p>
<h1>change to home</h1>
<p>cd
```</p>
<p>If these are left in, the script will attempt to put the site data in ~/sites instead of /usr/local/ebi/sites.</p>
<p>```</p>
<h1>fetch and updates the bety database</h1>
<p>./updatedb.sh
```</p>
<h3>Ruby installation</h3>
<p>The version of ruby available through yum is too low, so we have to use rvm
```
user$ \curl -L https://get.rvm.io | sudo bash -s stable
rvm install 1.9
rvm use 1.9</p>
<p>yum upgrade rubygem</p>
<p>yum install mysql-devel.x86_64
yum install ImageMagick-devel.x86_64
yum install rubygem-rails
yum install httpd-devel
wget http://www.sqlite.org/2013/sqlite-autoconf-3071700.tar.gz
tar -xzf sqlite-autoconf-3071700.tar.gz
cd sqlite-autoconf-3071700.tar.gz
./configure
make
make install
```</p>
<p>Then all the ruby gems bety needs.
<code>cd /usr/local/bety
gem install bundler
bundle install</code>
Configuration for Bety:
```
cd /usr/local/ebi/bety</p>
<h1>create folders for upload folders</h1>
<p>mkdir paperclip/files paperclip/file_names
chmod 777 paperclip/files paperclip/file_names</p>
<h1>create folder for log files</h1>
<p>mkdir log
touch log/production.log
chmod 0666 log/production.log
touch log/test.log
chmod 0666 log/test.log</p>
<p>cat &gt; config/database.yml &lt;&lt; EOF
production:
  adapter: mysql2
  encoding: latin1
  reconnect: false
  database: bety
  pool: 5
  username: bety
  password: bety</p>
<p>test:
  adapter: mysql2
  encoding: latin1
  reconnect: false
  database: test
  pool: 5
  username: bety
  password: bety
EOF</p>
<h1>setup login tokens ( actual REST_AUTH_SITE_KEY needs to be replaced with one matching the DB )</h1>
<p>cat &gt; config/initializers/site_keys.rb &lt;&lt; EOF
REST_AUTH_SITE_KEY         = 'thisisnotasecret'
REST_AUTH_DIGEST_STRETCHES = 10
EOF</p>
<h1>configure apache</h1>
<p>ln -s /usr/local/ebi/bety/public /var/www/bety</p>
<h1>http://wiki.apache.org/httpd/DistrosDefaultLayout</h1>
<p>cat &gt; /etc/httpd/conf.d/bety.conf &lt;&lt; EOF
RailsEnv production
RailsBaseURI /bety
DocumentRoot /usr/local/ebi/bety/public/
ServerName pecandev.igb.illinois.edu
<Directory /usr/local/beta/public >
        Options FollowSymLinks
        AllowOverride None
        Order allow,deny
        Allow from all
</Directory>
EOF
<code>You may have to change your DocumentRoot in /etc/httpd/conf/httpd.conf from "/var/www/html" to "/var/www" if you get the error message 'Passenger error #2 An error occurred while trying to access '/var/www/html/bety': Cannot resolve possible symlink '/var/www/html/bety': No such file or directory (2)'.
Up next make apache2 and passenger play nicely:</code>
rvmsudo passenger-install-apache2-module
<code>If that fails, try</code>
sudo -s
source <code>rvm gemdir</code>
```</p>
<p>Finally run the tests 
<code>cd /usr/local/eby/bety/
rake db:test:load &amp;&amp; rake db:fixtures:load RAILS_ENV=test &amp;&amp; rspec spec/</code></p>
<h3>Install Models</h3>
<p>Install the models biocro, sipnet, and ED as they are installed <a href="https://github.com/PecanProject/pecan/wiki/Installing-PEcAn#install-models">here</a>. </p>
<p>For biocro, there are some dependencies:
<code>echo "install.packages('devtools',repos='http://cran.rstudio.com/')"| R --vanilla
yum install udunits2-devel
sudo R CMD INSTALL udunits2 --configure-args='--with-udunits2-include=/usr/include/udunits2'</code></p>
<h3>Pecan Installation</h3>
<p>```</p>
<h1>download pecan</h1>
<p>cd /usr/local/ebi
git clone https://github.com/PecanProject/pecan.git</p>
<p>yum install netcdf-devel.x86_64 netcdf-static.x85_64 openmpi hdf5-devel.x86_64 openmpi-devel</p>
<h1>install PEcAn dependencies</h1>
<p>wget http://cran.r-project.org/src/contrib/ncdf4_1.6.1.tar.gz</p>
<p>rpm -Uvh http://www.hdfgroup.org/ftp/HDF5/current/bin/RPMS/hdf5-1.8.11-1.with.szip.encoder.el5.x86_64.rpm</p>
<p>wget http://cran.r-project.org/src/contrib/rjags_3-10.tar.gz</p>
<p>wget http://www.unidata.ucar.edu/downloads/netcdf/ftp/netcdf-4.3.0.tar.gz</p>
<p>tar -xzf netcdf-4.3.0.tar.gz
cd netcdf-4.3.0
export LDFLAGS="/usr/include/netcdf-3/"
sudo ./configure
sudo make install
cd ..
tar -xzf ncdf4_1.6.1.tar.gz
sudo R CMD INSTALL --configure-args="--with-nc-config=~/netcdf-4.3.0/nc-config" ncdf4</p>
<p>rpm -Uvh http://www6.atomicorp.com/channels/atomic/centos/5/x86_64/RPMS/sqlite-3.7.0.1-1.el5.art.x86_64.rpm</p>
<p>wget   http://download.osgeo.org/gdal/1.10.0/gdal-1.10.0.tar.gz
tar -xzf gdal-1.10.0.tar.gz
cd gdal-1.10.0
sudo ./configure
sudo make install</p>
<p>sudo yum install atlas blas.x86_64
sudo rpm -Uvh  http://download.opensuse.org/repositories/home:/cornell_vrdc/CentOS_CentOS-5/x86_64/jags3-3.3.0-48.1.x86_64.rpm
sudo rpm -Uvh http://download.opensuse.org/repositories/home:/cornell_vrdc/CentOS_CentOS-5/x86_64/jags3-devel-3.3.0-48.1.x86_64.rpm</p>
<p>yum install proj-devel.x86_64 udunits2-devel.x86_64</p>
<p>wget http://cran.r-project.org/src/contrib/rgdal_0.8-9.tar.gz
tar -xzf rgdal_0.8-9.tar.gz
echo "/usr/local/lib" &gt;&gt; /etc/ld.so.conf.d/gdal.conf
ldconfig -v
R CMD INSTALL rgdal --configure-args='--with-gdal-config=/usr/local/bin/gdal-config'</p>
<h1>install PEcAn packages in R</h1>
<p>cd pecan
R --vanilla &lt; scripts/install.dependencies.R</p>
<h1>compile pecan</h1>
<p>./scripts/build.sh
```</p>
<h3>PostgreSQL</h3>
<p>Although BETY currently uses MySQL, support for or migration to PostgresSQL is planned.</p>
<h4>Installing Postgres</h4>
<p><a href="http://wiki.postgresql.org/wiki/YUM_Installation">reference</a>
add <code>exclude=postgresql*</code> to the <code>[base]</code> and <code>[updates]</code> sections of  <code>/etc/yum.repos.d/CentOS-Base.repo</code></p>
<p>```</p>
<h1>download repo</h1>
<p>curl -O http://yum.postgresql.org/9.2/redhat/rhel-5-x86_64/pgdg-centos92-9.2-6.noarch.rpm</p>
<h1>install repo</h1>
<p>rpm -ivh pgdg-centos92-9.2-6.noarch.rpm </p>
<h1>list available packages</h1>
<p>yum list postgres*</p>
<h1>install postgres 9.2</h1>
<p>yum install postgresql92-server</p>
<h1>initialize database</h1>
<p>/sbin/service postgresql-9.2 initdb</p>
<h1>automatically start postgres</h1>
<p>/sbin/chkconfig postgresql-9.2 on
```</p>
<h4>configuring postgres <a href="http://wiki.postgresql.org/wiki/First_steps">reference</a></h4>
<p>```</p>
<h1>set root (postgres) password <a href="http://stackoverflow.com/q/12720967">reference</a></h1>
<p>sudo -u postgres psql
alter user postgres with password 'new_password' 
```</p>
<h2>Installing Virtualbox</h2>
<p><a href="http://wiki.centos.org/HowTos/Virtualization/VirtualBox#head-81de410879b8e7f18a127f638160e036ab99684e">reference</a></p>
<p><code>cd /etc/yum.repos.d
wget http://download.virtualbox.org/virtualbox/rpm/rhel/virtualbox.repo
yum install dkms
yum groupinstall "Development Tools"
yum install kernel-devel
yum install VirtualBox-4.2
usermod -a -G vboxusers &lt;username&gt;</code></p>